## 6.2 테이블 압축

테이블 압축은 우선 디스크의 데이터 파일 크기를 줄일 수 있기 때문에 그만큼의 이득은 있다. 하지만 다음의 단점이 있다.

- 버퍼 풀 공간 활용률 낮음
- 쿼리 처리 성능 낮음
- 빈번한 데이터 변경시 압축률이 떨어짐

### 6.2.1 압축 테이블 생성

``` mysql
mysql> SET GLOBAL innodb_file_per_table=ON;
mysql> CREATE TABLE compressed_table (
					c1 INT PRIMARY KEY
				)
				ROW_FORMAT=COMPRESSED
				KEY_BLOCK_SIZE=8;
```

압축 적용에 사용되는 KEY_BLOCK_SIZE 옵션은 압축된 페이지가 저장될 페이지의 크기를 지정한다. 

다음은 페이지 크기가 16KB 그리고 KEY_BLOCK_SIZE가 8로 설정되었을때 InnoDB 스토리지 엔진이 압축을 적용하는 방법이다.

1. 16KB 데이터 페이지를 압축

   1-1. 압축된 결과가 8KB 이하이면 그대로 디스크에 저장(압축 완료)

   1-2. 압축된 결과가 8KB 초과하면 원본 페이지를 스플릿(split)해서 2개의 페이지에 8KB씩 저장

2. 나뉜 페이지 각각에 대해 1번 단계를 반복 실행

테이블 압축 방식에서 가장 중요한 것은 원본 데이터 페이지의 압축 결과가 목표 크기(KEY_BLOCK_SIZE)보다 작거나 같을 때까지 반복해서 페이지를 스플릿한다는 것이다. 그래서 목표 크기가 잘못 설정되면 MySQL서버의 처리 성능이 급격히 떨어질 수 있으니 주의해야한다.