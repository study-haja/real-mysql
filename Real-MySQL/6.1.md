# 6. 데이터 압축

MySQL 서버에서 디스크에 저장된 데이터 파일의 크기는 일반적으로 쿼리의 처리 성능과도 직결되지만 백업 및 복구시간과도 밀접하게 연결된다.

MySQL 서버에서 사용 가능한 압축 방식은 크게 테이블 압축과 페이지 압축의 두가지 종류로 구분할 수 있다.

## 6.1 데이터 압축

페이지 압축은 "Transparent Page Compression" 이라고도 불리는데, MySQL 서버가 디스크에 저장하느 시점에 데이터 페이지가 압축되어 저장되고, 반대로 MySQL 서버가 디스크에서 데이터 페이지를 읽어올때 압축이 해제되기 때문이다. 16KB 데이터 페이지를 압축한 결과가 용량이 얼마나 될지 예측이 불가능하지만 적어도 하나의 테이블은 동일한 크기의 페이지로 통일돼어야 한다.

이를 지원하기 위해서 운영체제별로 특정 버전의 파일 시스템에서만 지원되는 Punch hole이라는 기능을 사용한다. 운영체제의 블록 사이즈가 512 바이트인 경우, 데이터 압축은 다음처럼 동작한다.

![MySQL 데이터 압축 - Table Compress - Data Compress - 페이지 압축 | Hoing](https://hoing.io/storage/2021/11/page_comp_img_1.png)

1. 16KB 페이지를 압축(압축 결과를 7KB로 가정)
2. MySQL 서버는 디스크에 압축된 결과 7KB를 기록(이때 MySQL 서버는 압축 데이터 7KB에 9KB의 빈 데이터를 기록)
3. 디스크에 데이터를 기록한 후, 7KB 이후의 공간 9KB에 대해 펀치 홀(Punch-hole)을 생성
4. 파일 시스템은 7KB만 남기고 나머지 디스크의 9KB 공간은 다시 운영체제로 반납
5. 데이터를 읽을때는 압축된 데이터 7KB와 펀치홀 공간 9KB를 합친 16KB를 읽는다.

### 자주 사용되지 않는 이유

- 펀치 홀 기능은 운영체제 뿐만 아니라 하드웨어 자체에서도 기능을 지원해야 사용 가능하다.
- 파일 시스템 관련 명령어(유틸리티)가 펀치 홀을 지원하지 못한다.

