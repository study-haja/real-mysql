# 인덱스 키 추가

새로운 키 값이 B-Tree로 저장 될 때 테이블의 스토리지 엔진에 따라 새로운 키 값이 즉시 인덱스에 저장될 수도 있고 그렇지 않을 수 도 있다.

B-Tree에 저장될 때는 저절한 위치를 검색해야 하며 위치가 결정되면 레코드의 키값과 레코드 주소 정보를 B-Tree 리프 노드에 저장한다. 만약 리프 노드가 꽉 차서 분리해야 한다면 처리 범위가 상위 노드까지 넓어진다. 이러한 작업 탓에 B-Tree는 상대적으로 쓰기 작업에 비용이 많이 드는 것으로 알려졌다.

보통 레코드 추가하는 작업을 1이라 하면, 인덱스 키를 추가하는 작업 비용은 1.5라 보면 된다. 예를 들어 테이블에 인덱스가 3개 있다면 테이블의 인덱스가 하나도 없는 경우 작업 비용 1, 각각의 인덱스 1.5 * 3 즉 (1.5 * 3 +1) = 5.5 정도의 작업 비용이 든다고 보면 된다. 여기서 중요한 점은 비용의 대부분이 메모리와 CPU 처리하는 시간이 아니라 디스크로부터 인덱스 페이지를 읽고 쓰기를 해야해서 걸리는 시간이라는 점이다.

MyISAM이나 MEMORY 스토리지 엔진을 사용하는 테이블에서 INSERT를 하면 새로운 키 값을 B-Tree 인덱스에 변경한다. 하지만 InnoDB는 좀더 지능적으로 처리하는데, 필요하다면 인덱스 키 작업을 나중에 처리 할 수 있다. 하지만 프라이머리 키나 유니크 키 같은 경우 중복 체크가 필요하기 때문에 즉시 B-Tree에 추가되거나 삭제된다.