# 7.1.2 암호화와 성능

MySQL 서버의 암호화는 TDE 방식이기 때문에 디스크로부터 한번 읽은 데이터 페이지는 복호화되어 InnoDB 버퍼 풀에 저장된다. 따라서 데이터 페이지가 한번 메모리에 적대되면 암호화되지 않은 테이블과 동일한 성능을 보인다.

하지만 버퍼 풀에 존재하지 않은 데이터 페이지를 읽어야 하는 경우 복호화 과정을 거치기 때문에 쿼리 처리가 많이 지연될 것이다. 또한 암호화된 테이블이 변경되면 다시 디스크로 동기화될 때 암호화돼야 하기 때문에 디스크에 저장할 때도 추가로 시간이 걸린다.

그러나 데이터 페이지 저장은 사용자의 쿼리를 처리하는 쓰레드가 아닌 MySQL 서버 백그라운드 쓰레드가 수행하기 때문에 실제 사용자 쿼리가 지연되는 것은 아니다.

MySQL 암호화 알고리즘은 AES를 사용하고 있다. 이 알고리즘은 암호화하고자 하는 평문의 길이가 짧은 경우나 데이터 페이지의 암호화를 하는 경우나 동일한 크기의 암호문을 반환한다. 즉 암호화 한다고 해서 InnoDB 버퍼 풀의 효율이 달라지거나 메모리 사용 효율이 떨어지는 현상은 발생하지 않는다.

같은 테이블에 압축과 암호화가 동시에 일어나면 압축을 먼저 하고 암호화를 한다. 그 이유는 다음과 같다.

> 1. 암호화된 결과문은 랜덤한 바이트 배열을 가지게 되는데, 이는 압축률을 상당히 떨어트린다. 따라서 압축률을 높히기 위해 압축하여 용량을 최소화 시킨뒤 암호화를 한다.
> 2. 암호화된 테이블의 데이터 페이지는 복호화된 상태로 InnoDB 버퍼 풀에 저장되지만 압축된 데이터는 InnoDB 버퍼풀에 압축 또는 압축 해제 된 상태로 존재할 수 있다. 따라서 암호화가 먼저 실행되면 InnoDB 버퍼 풀에 존재하는 데이터 페이지에 대해서도 매번 암복호화 작업을 수행해야 한다.

