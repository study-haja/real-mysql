# 기본 데이터 처리

모든 RDBMS는 데이터를 정렬하거나 그루핑하는 등의 기본 데이터 가공 기능을 가지고 있다. 하지만 결과물은 동일하더라도 RDBMS 별로 그 결과를 만들어 내는 과정은 천차만별이다. 따라서 어떤 알고리즘을 사용하는지 보자.

# 풀 테이블 스캔과 풀 인덱스 스캔

플 테이블 스캔은 인덱스를 사용하지 않고 테이블의 데이터를 처음부터 끝까지 읽어서 요청된 작업을 처리하는 것을 의미한다.

주로 다음과 같은 조건이 일치할때 풀테이블 스캔을 사용한다.

1. 테이블의 레코드 건수가 너무 작아서 인덱스를 통해 읽는 것보다 풀 테이블 스캔을 하는 편이 더 빠를 경우
2. `WHERE`절이나 `ON`절에 인덱스를 이용할 수 있는 적절한 조건이 없는 경우
3. 인덱스 레인지 스캔을 사용할 수 있는 쿼리라고 하더라도 옵티마이저가 판단한 조건 일치 레코드 건수가 너무 많은 경우

일반적으로 풀 테이블 스캔은 여러 개의 블록이나 페이지를 읽어오는 기능을 내장하고 있다.

InnoDB도 페이지를 몇개씩 읽어올지 설정하는 시스템 변수는 없지만, 백그라운 쓰레드에 의해 리드 어해드 작업이 자동으로 시작되어 몇개의 페이지 동시에 읽게 한다.

즉 MyISAM과 같은 스토리지 엔진은 디스크로 부터 하나씩 읽어오지만, InnoDB는 처음 몇개의 데이터 페이지는 포그라운드 쓰레드가 페이지 읽기를 실행하고 특정 시점부터 읽기 작업을 백그라운 쓰레드로 넘겨 4개 8개 등 최대 64개의 데이터 페이지 까지 읽어오게 만들고 버퍼 풀에 저장한다. 그리고 포그라운드 쓰레드가 해당 버퍼 풀에 접근해 데이터를 읽어 쿼리가 상당히 빠르게 처리되게 만든다.

`innodb_read_ahead_threshold` 시스템 변수를 통해 InnoDB 스토리지 엔진이 언제 리드 어헤드를 시작할지 임계값을 설정할 수 있다. 일반적으로 디폴트 값이면 데이터를 읽어오는데 충분하지만, 만약 데이터 웨어하우스로 MySQL를 사용하게 된다면 위 변수값을 낮은 값으로 설정해서 더 빨리 리드 어헤드가 시작되게 만드는 것이 좋다.

리드 어헤드는 풀테이블 스캔뿐만 아니라 풀 인덱스 스캔에서도 동일하게 사용된다.

풀 인덱스 스캔은 인덱스를 처음부터 끝까지 스캔하는 것인데 다음 예를 보자

```mysql
> SELECT COUNT(*) FROM employees;
```

위 쿼리는 아무런 조건이 없기 때문에 풀 테이블 스캔할 것 처럼 보이지만, 실제로는 풀 인덱스 스캔을 할 가능성이 높다. 그 이유는 옵티마이저에서 단순 레코드 건수만 필요로 하는 쿼리라면 용량이 작은 인덱스를 사용하기 때문이다. 

만약 `COUNT`가 아닌 일반 `*` 을 찾는거라면 풀 테이블 스캔을 할 것이다.