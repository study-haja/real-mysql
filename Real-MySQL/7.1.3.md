# 7.1.3 암호화와 복제

MySQL 서버에서 데이터를 복제시 데이터가 같을거라 생각하지만, 사실은 전혀 그렇지 않다. 그 이유는 TDE 방식을 사용하고 있기 때문에 각 서버에서 각자의 마스터 키를 가지고 관리를 하기 때문이다.

즉 복제시 마스터 키 자체가 복제되지 않기 때문에 테이블스페이스 키 또한 레플리카로 복제되지 않는다. 따라서 각자의 키가 다르기 때문에 암호화된 데이터가 저장된 데이터 파일의 내용은 완전 다를 수 밖에 없다.

복제 소스 서버의 마스터 키를 변경할 때는 다음과 같다.

```mysql
> ALTER INSTANCE ROTATE INNODB MASTER KEY
```

위 명령 자체는 레플리카 서버로 복제되지만 실제 소스 서버의 마스터 키 자체가 레플리카로 전달되는 것은 아니다. 따라서 마스터 키 로테이션을 실행하면 소스 서버와 레플리카 서버가 각각 서로 다른 마스터 키를 새로 발급 받는다.

참고로 TDE의 키링 파일을 백업하지 않는 경우가 있는데, 이 경우 키링 파일을 찾지 못하면 데이터 복구를 할 수 없게 된다. 그러니 키링 파일을 백업하는 것이 좋다. 