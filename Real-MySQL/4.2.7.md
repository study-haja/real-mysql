# 버퍼 풀의 적재 내용 확인

MySQL 5.6 버전부터 IInnoDB 버퍼 풀 메모리에 어떤 테이블의 페이지가 적재되었는지 확인할 수 있다. 하지만 버퍼 풀이 큰 경우 테이블 조회가 상당히 큰 부하를 일으키면서 서비스 쿼리가 많이 느려지는 문제가 생겼다.

따라서 8.0부터는 innodb_cached_indexes 테이블을 만들어 성능을 해결했다.

MySQL 서버는 테이블 인덱스별로 페이지가 InnoDB 버퍼 풀에 적재된 비율을 알려주지 않는다. 따라서 테이블 단위로 전체 데이터 페이지 개수와 InnoDB 버퍼 풀에 적재된 데이터 페이지 개수의 합을 조회해야 한다.

* 인덱스별로 데이터 페이지가 InnoDB 버퍼 풀에 얼마나 적재돼 있는지 확인할 수 있는 명령어

```mysql
> SELECT 
		it.name table_name
		ii.name index_name,
		ici.n_cached_pages n_cached_pages
	FROM information_schema.innodb_tables it
		INNER JOIN information_schema.innodb_indexes ii ON ii.table_id = it.table_id
		INNER JOIN information_schema.innodb_cached_indexes ici ON ici.table_id = ii.table_id
	WHERE it.name=CONCAT('emplee', '/', 'employees');
```

* 테이블 전체 페이지 중에서 대략 어느 정도 비율이 InnoDB 버퍼 풀에 적재돼어 있는지 확인하는 명령어

```mysql
> SELECT
		(SELECT SUM(ici.n_cached_pages) n_cached_pages
		 FROM incormation_schema.innodb_tables it
     	INNER JOIN information_schema.innodb_indexes ii ON ii.table_id = it.table_id
     	INNER JOIN information_schema.innodb_cached_indexes ici ON ici.table_id = ii.table_id
     WHERE it.name=CONCAT(t.table_schema, '/', t.table_name)) as total_cached_pages,
     ((t.data_length + t.index_length - t.data_free)/@@innodb_page_size) as total_pages
  FROM information_schema.tables t
  WHERE t.table_schema='employees'
     AND t.table_name='employees';
     
 결과
 total_cached_pages | total_pages
 --------------------------------
                322 |  1668.0000
```

