# 7.2 keyring_file 플러그인 설치

TDE의 암호화 키 관리는 플러그인 방식으로 제공된다. 엔터프라이즈는 사용할 수 있는 플러그인이 다양하지만 커뮤니티 에디션은 keyring_file 플러그인만 가능하다.

keyring_file 플러그인은 테이블스페이스 키를 안모화하기 위한 마스터 키를 디스크 파일로 관리하는데, 이때 마스터 키는 평문으로 디스크에 저장된다. 즉 마스터 키가 저장된 파일이  외부에 노출된다면 데이터 암호화는 무용지물이 된다. 

그렇기 때문에 MySQL 서버가 시작될 때만 키링 파일을 다른 서버로부터 다운로드해서 로컬 디스크에 저장한 후 MySQL 서버를 시작하는 방법을 고려해보자. 또한 캐싱을 하기 때문에 로컬에 키링 파일을 삭제해도 서버가 작동하는데 문제가 없다. 그리고 마스터 키를 로테이션하는 경우에는 로컬의 키링 파일이 최신이 되므로 원본을 외부 서버에 복사해 둬야한다.

TDE 플러그인은 MySQL 서버가 시작하는 동시에 가장 빨리 초기화돼야 한다. 따라서 시스템 변수 `early-plugin-load`에 kering_file.so를 명시하고 `kering_file_data` 시스템 변수에 키링 파일 경로를 설정해 두어 초기화 시킨다. 

그리고 MySQL 서버를 재시작하면 플러그인이 초기화된고 `SHOW PLUGINS;` 명령어를 통해 확인이 가능하다. 

keyring_file 플러그인이 초기화 되면 `keyring_file_data` 시스템 변수의 경로에 빈 파일이 생긴다. 플러그인만 초기화된 상태일 뿐, 아직 마스터 키를 사용한적이 없기 때문에 실제 키링 파일의 내용은 비어 있다.