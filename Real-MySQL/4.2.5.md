### 4.2.5 자동 데드락 감지

- InnoDB 스토리지 엔진은 내부적으로 잠금이 교착 상태에 빠지지 않았는지 체크하기 위해 잠금 대기 목록을 그래프(Wait-for List) 형태로 관리한다. InnoDB 스토리지 엔진은 데드락 감지 스레드를 가지고 있어서 데드락 감지 스레드가 주기적으로 잠금 대기 그래프를 검사해 교착 상태에 빠진 트랜젝션들을 찾아서 그중 하나를 강제 종료함. 이때 언두 로그 레코드를 더 적게 가진 트랜젝션이 일반적으로 롤백의 대상이 됨.
- 데드락 감지 스레드는 잠금 목록을 검사해야 하기 때문에 잠금 상태가 변경되지 않도록 잠금 목록이 저장된 리스트(잠금 테이블)에 새로운 잠금을 걸고 데드락 스레드를 찾게 된다. 데드락 감지 스레드가 느려지면 서비스 쿼리를 처리 중인 스레드는 더는 작업을 진행하지 못하고 대기하면서 서비스에 악영향을 미치게 된다.
- 이런 문제를 해결하기 위해 `innodb_deadlock_detect` 시스템 변수를 제공하며, `OFF` 로 설정하면 감지 스레드는 더는 작동하지 않게 된다. 하지만 데드락 상황을 해결할수 없다. 따라서 `innodb_lock_wait_timeout` 변수를 설정하여 일정 시간이 지나면 자동으로 요청이 실패하고 에러 메시지를 반환하도록 하는것을 권장한다. 기본값인 50초보다 훨씬 낮은 시간으로 변경하는 것을 권장한다.