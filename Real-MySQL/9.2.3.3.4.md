# 정렬 처리 방법의 성능 비교

LIMIT은 일반적으로 테이블이나 처리 결과의 일부만 가져오기 때문에 MYSQL 서버가 처리해야 할 작업량을 줄이는 역할을 한다.

하지만 GROUP BY, ORDER BY는 WHERE 조건절을 만족하는 레코드를 LIMIT 건수만큼 가져와서는 처리할 수 없다. 우선 조건을 만족하는 레코드를 모두 가져와서 정렬을 수행하거나 그루핑 작업을 실행해야만 비로소 LIMIT으로 건수를 제한할 수 있다. 

이는 WHERE 조건절의 아무리 index를 잘 활용했더라도 GROUP BY, ORDER BY 때문에 느려지는 경향이 있다.



## 스트리밍 방식

서버 쪽에서 처리할 데이터가 얼마인지에 관계없이 조건에 일치하는 레코드가 검색될 때마다 바로바로 클라이언트로 전송해주는 방식을 의미한다. 즉 클라이언트는 쿼리를 요청하고 곧바로 첫번째 레코드를 받는다.

이 방식은 곧바로 데이터를 받기 때문에 클라이언트에서 동시에 데이터의 가공 작업을 진행할 수 있다. 또한 LIMIT처럼 결과 건수를 제한하는 조건들을 가지는 쿼리는 가져오는 데이터 수를 줄여주기 때문에 실행 시간을 상당히 줄여줄 수 있다. 



## 버퍼링 방식

ORDER BY, GROUP BY 같은 처리는 쿼리의 결과가 스트리밍되는 것을 불가능하게 한다. 우선 WHERE 조건에 일치하는 모든 레코드를 가져온 후, 정렬하거나 그루핑해서 차례대로 보내야 하기 때문이다.

MySQL 서버에서는 모든 레코드를 검색하고 정렬 작업을 하는 동안 클라이언트는 아무것도 하지 않고 기다려야 하기 때문에 응답 속도가 느려진다. 즉 쿼리로 가지고 오는 데이터를 버퍼링하여 한번에 처리하기 때문에 LIMIT이 있어도 성능 향상에 별 도움이 안된다.

정렬 처리 방법 중이 인덱스를 사용한 정렬방식만 스트리밍 형태의 처리이고 나머지는 버퍼링 형태의 처리이다. 그렇기 때문에 정리하자면 가능한 인덱스를 사용한 정렬로 유도하고, 그렇지 못한다면 최소한 드라이빙 테이블만 정렬해도 되는 수준으로 유도하는 것이 좋은 튜닝 방법이다.



## JDBC

참고로 JDBC 라이브러리를 사용하는 경우 MySQL에서는 스트리밍 형태로 JDBC 클라이언트에게 바로 데이터를 넘겨준다. 하지만 JDBC 내에서 마지막 레코드를 받을 때까지 기다리고 모든 결과를 받고나면 애플리케이션에 반환하기 때문에 이는 MySQL이 아닌 JDBC가 버퍼링 처리를 한다.

JDBC가 이 방식을 사용한 이유는 전체 처리 시간이 짧고 MySQL 서버와의 통신 횟수가 적어 자원 소모를 줄일 수 있기 때문에 이 방식을 사용했다. 이렇게 해야 서버로부터 전송되는 데이터를 받아서 저장만 하기 때문에 네트워크 요청이 최소화되어 전체 처리량이 뛰어나다.