# MRR과 배치 키 액세스 (mrr & batched_key_access)

지금까지 조인 방식은 드라이빙 테이블의 레코드를 한 건 읽어서 드리븐 테이블의 일치하는 레코드를 찾아서 조인을 수행한다. 이를 네스티드 루프 조인이라고 하는데 MySQL은 내부 구조상 조인 처리는 **MySQL엔진**이 처리하지만, 실제 레코드를 검색하는 부분은 **스토리지 엔진**이 담당한다.

그렇기 때문에 드리븐 테이블의 레코드를 찾으면 레코드를 찾고 읽는 스토리지 엔진에서는 아무런 최적화를 하지 못한다.

이를 해결하기 위해 MySQL 서버는 조인 대상 테이블 중 하나로부터 레코드를 읽어서 조인 버퍼에 버퍼링한다. 즉 드라이빙 테이블의 레코드를 읽어서 즉시 실행하지 않고 조인 대상을 버퍼링하는 것이다. 그리고 레코드가 차면 버퍼링된 레코드를 스토리지 엔지으로 한번에 요청한다. 이러한 방법을 **MRR(Multi-Range Read)**라 부른다.

이는 스토리지 엔진이 읽어야 할 레코드들을 데이터 페이지에 정렬된 순서로 접근해서 디스크의 데이터 페이지 읽기를 최소화할 수 있기 때문에 좋다. 또한 버퍼풀의 접근을 최소화 할 수 있어 성능 최적화를 할 수 있다. 그리고 MRR을 응용해서 실행되는 조인 방식을 BKA라 부른다.

하지만 MRR, BKA 방식은 부가적인 정렬 작업이 필요해지면서 오히려 성능에 안좋은 영향을 미치는 경우도 있기 때문에 조심히 사용해야 한다.